<div id="las-mat-tool" style="max-width:1000px;margin:0 auto;font-family:Inter,Arial,system-ui;line-height:1.55;color:#0b0c0c;">
  <style>
    :root{
      --las-green:#023020;
      --las-green-2:#085613;
      --ink:#0b0c0c;
      --muted:#4a4a4a;
      --border:#DFE3E8;
      --bg:#ffffff;
      --soft:#f6f8fa;
      --soft2:#eef7f0;
      --warn:#7a4b00;
      --warnbg:#fff4e5;
      --danger:#8a1f11;
      --dangerbg:#fdecea;
      --ok:#0b6b2f;
      --okbg:#e7f6ee;
      --shadow:0 10px 22px rgba(0,0,0,.06);
      --radius:14px;
    }
    *{box-sizing:border-box}
    h1,h2,h3{margin:0 0 10px}
    h1{font-size:28px;line-height:1.2;color:var(--las-green)}
    h2{font-size:18px;color:var(--las-green)}
    p{margin:0 0 10px}
    .header{
      padding:18px 18px;
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:linear-gradient(135deg,var(--soft2) 0%, #f4f8ff 60%);
      box-shadow:var(--shadow);
      margin:10px 0 14px;
    }
    .sub{color:#1c2b21;font-size:14px;margin-top:6px}
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      margin: 10px 0 14px;
    }
    .card{
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:var(--bg);
      padding:14px;
      box-shadow:var(--shadow);
    }
    .note{
      border:1px solid var(--border);
      border-radius:12px;
      background:var(--soft);
      padding:12px;
      color:var(--muted);
      font-size:13px;
    }
    .alert{
      border-radius:12px;
      padding:12px;
      font-size:13px;
      border:1px solid;
    }
    .alert.warn{background:var(--warnbg);border-color:#ffd59a;color:var(--warn)}
    .alert.danger{background:var(--dangerbg);border-color:#f7c2ba;color:var(--danger)}
    .alert.ok{background:var(--okbg);border-color:#b9e4c8;color:var(--ok)}
    .two-col{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 820px){
      .two-col{grid-template-columns:1fr}
    }

    label{display:block;font-weight:600;margin:0 0 6px;color:#1c2b21;font-size:13px}
    input, select{
      width:100%;
      padding:10px 10px;
      border:1px solid var(--border);
      border-radius:10px;
      font-size:14px;
      background:#fff;
      color:var(--ink);
    }
    input[disabled]{background:#f1f3f5;color:#6b6b6b}
    .row{
      display:grid;
      grid-template-columns: 120px 170px 1fr 1fr;
      gap:10px;
      align-items:end;
      padding:10px 0;
      border-bottom:1px solid var(--border);
    }
    .row:last-child{border-bottom:0}
    .row .small{font-size:12px;color:var(--muted)}
    .pill{
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      font-size:12px;
      background:#eef3f0;
      color:var(--las-green);
      border:1px solid #d7e3dc;
      margin-left:8px;
      vertical-align:middle;
    }

    .actions{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      margin-top:12px;
    }
    button{
      border:0;
      background:var(--las-green);
      color:#fff;
      padding:10px 14px;
      border-radius:12px;
      font-weight:700;
      cursor:pointer;
      font-size:14px;
    }
    button.secondary{
      background:#1f2937;
    }
    button.ghost{
      background:#fff;
      color:var(--las-green);
      border:1px solid var(--border);
    }
    button:focus, input:focus, select:focus{
      outline:3px solid rgba(2,48,32,.18);
      outline-offset:2px;
    }

    .results{
      overflow:auto;
      border:1px solid var(--border);
      border-radius:12px;
    }
    table{
      width:100%;
      border-collapse:collapse;
      min-width: 820px;
      background:#fff;
    }
    th, td{
      text-align:left;
      padding:10px 10px;
      border-bottom:1px solid var(--border);
      font-size:13px;
      vertical-align:top;
    }
    th{
      background:#f7faf8;
      color:#1c2b21;
      position:sticky; top:0;
      z-index:1;
    }
    tfoot td{font-weight:800}
    .right{text-align:right}
    .muted{color:var(--muted)}
    .mini{font-size:12px}
    .print-area{display:none}
    @media print{
      body *{visibility:hidden}
      #las-mat-tool, #las-mat-tool *{visibility:visible}
      #las-mat-tool{max-width:none;margin:0}
      .actions, .note, .alert.warn, .alert.danger{display:none !important}
      .card{box-shadow:none}
      table{min-width:0}
    }
  </style>

  <div class="header">
    <h1>Maternity Leave & NHS Pension Contributions (Estimator)</h1>
    <p class="sub">Use this tool to estimate how employee pension deductions may be taken during maternity leave, and what arrears may be collected on return if you have unpaid months.</p>
    <div class="alert danger" style="margin-top:10px;">
      <strong>Opting out warning:</strong> If you opt out of the NHS Pension Scheme, you will not build pension during that period and you will not be entitled to life assurance benefits while opted out.
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h2>Step 1 — Enter your key figures</h2>

      <div class="two-col" style="margin-top:10px;">
        <div>
          <label for="empRate">Your employee contribution rate (%)</label>
          <input id="empRate" type="number" inputmode="decimal" min="0" max="99" step="0.01" placeholder="e.g. 9.8" />
          <div class="mini muted" style="margin-top:6px;">Tip: copy this from your payslip (pension %).</div>
        </div>

        <div>
          <label for="preLeavePay">Pre-leave monthly pensionable pay (before any reduction) (£)</label>
          <input id="preLeavePay" type="number" inputmode="decimal" min="0" step="0.01" placeholder="e.g. 3500.00" />
          <div class="mini muted" style="margin-top:6px;">Used to estimate arrears during unpaid months, and to inform additional contributions.</div>
        </div>

        <div>
          <label for="monthsCount">Number of months to plan</label>
          <select id="monthsCount">
            <option value="12" selected>12 months</option>
            <option value="13">13 months</option>
            <option value="14">14 months</option>
            <option value="15">15 months</option>
            <option value="16">16 months</option>
            <option value="17">17 months</option>
            <option value="18">18 months</option>
          </select>
          <div class="mini muted" style="margin-top:6px;">You can change this anytime.</div>
        </div>

        <div>
          <label for="spreadPay">
            <input id="spreadPay" type="checkbox" style="width:auto;transform:translateY(2px);margin-right:8px;" />
            My maternity pay is being spread evenly (e.g. paid over 12 months)
          </label>
          <div class="mini muted">Where pay is “smoothed”, payroll may apply pension adjustment entries so contributions reflect the normal maternity pay pattern.</div>
        </div>
      </div>

      <div class="card" style="margin-top:12px;background:#fff;border:1px dashed var(--border);">
        <h3 style="margin:0 0 8px;color:var(--las-green);font-size:16px;">
          Optional — Additional contributions (Added Years / Additional Pension / ERRBO)
          <span class="pill">optional</span>
        </h3>

        <div class="two-col">
          <div>
            <label for="hasAdditional">
              <input id="hasAdditional" type="checkbox" style="width:auto;transform:translateY(2px);margin-right:8px;" />
              I pay additional contributions
            </label>
            <div class="mini muted">If you’re not sure, check your payslip for Added Years / Additional Pension / ERRBO deductions.</div>
          </div>

          <div>
            <label for="additionalMonthly">Normal monthly additional contribution (£)</label>
            <input id="additionalMonthly" type="number" inputmode="decimal" min="0" step="0.01" placeholder="e.g. 45.00" disabled />
            <div class="mini muted" style="margin-top:6px;">
              These are generally based on your pensionable pay before any reduction.
            </div>
          </div>

          <div>
            <label for="recoverAdditionalArrears">
              <input id="recoverAdditionalArrears" type="checkbox" style="width:auto;transform:translateY(2px);margin-right:8px;" disabled />
              Recover additional contribution arrears during unpaid months (estimate)
            </label>
            <div class="mini muted">If you have unpaid months, this estimates additional arrears too (common where the deduction cannot be taken).</div>
          </div>
        </div>
      </div>

      <div id="spreadWarning" class="alert warn" style="margin-top:12px;display:none;">
        <strong>Pay spread evenly:</strong> Contributions shown are an estimate. Where pay is spread across the absence, contributions are still due as if maternity pay had been paid in the normal way. Payroll may apply pension adjustment entries.
      </div>

      <div class="note" style="margin-top:12px;">
        <strong>Important notes</strong>
        <ul style="margin:8px 0 0 18px;">
          <li>KIT / SPLiT days do not break maternity leave for pension purposes. Any <strong>additional</strong> KIT / SPLiT pay should be excluded from pensionable pay for pension calculations.</li>
          <li>Employer contributions continue if you remain in the scheme (this tool focuses on your employee deductions).</li>
          <li>If you opt out, no contributions are taken during opt-out, and you lose life assurance cover while opted out.</li>
        </ul>
      </div>
    </div>

    <div class="card">
      <h2>Step 2 — Enter your maternity pay by month</h2>
      <p class="muted mini">Enter the pensionable pay you expect to receive each month (use Payroll figures if you have them). For <strong>Unpaid</strong> months the tool estimates arrears using your pre-leave pensionable pay.</p>

      <div id="monthsGrid" style="margin-top:10px;"></div>

      <div class="actions">
        <button id="calcBtn" type="button">Calculate estimate</button>
        <button id="resetBtn" class="ghost" type="button">Reset</button>
        <button id="printBtn" class="secondary" type="button">Print</button>
        <span id="status" class="mini muted"></span>
      </div>
    </div>

    <div class="card">
      <h2>Results</h2>
      <div id="validation" class="alert danger" style="display:none;margin-bottom:10px;"></div>

      <div class="results">
        <table aria-label="Estimated pension deductions table">
          <thead>
            <tr>
              <th style="width:110px;">Month</th>
              <th style="width:170px;">Pay type</th>
              <th class="right">Pensionable pay used (£)</th>
              <th class="right">Employee deduction (£)</th>
              <th class="right">Employee arrears (£)</th>
              <th class="right">Additional deduction (£)</th>
              <th class="right">Additional arrears (£)</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody id="resultsBody">
            <tr>
              <td colspan="8" class="muted">No results yet — enter your figures and click “Calculate estimate”.</td>
            </tr>
          </tbody>
          <tfoot id="resultsFoot" style="display:none;">
            <tr>
              <td colspan="3">Totals</td>
              <td class="right" id="totEmpDed">£0.00</td>
              <td class="right" id="totEmpArr">£0.00</td>
              <td class="right" id="totAddDed">£0.00</td>
              <td class="right" id="totAddArr">£0.00</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div id="arrearsMsg" class="alert ok" style="display:none;margin-top:12px;">
        <strong>Arrears on return to work:</strong>
        <div class="mini" style="margin-top:6px;">
          If you have unpaid months, payroll may collect employee (and where applicable additional) contribution arrears when you return to work. This is often recovered over the same number of pay periods the arrears accrued, unless a different reasonable plan is agreed.
        </div>
      </div>

      <div class="note" style="margin-top:12px;">
        <strong>What this tool does (and doesn’t) do</strong>
        <ul style="margin:8px 0 0 18px;">
          <li>This is an <strong>estimate</strong> based on the figures you enter.</li>
          <li>If your pay is being “smoothed” across the absence, payroll may apply adjustments so contributions reflect the normal maternity pay pattern.</li>
          <li>This tool does not calculate employer contributions or benefits — it focuses on estimating your deductions and any arrears.</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const $ = (id) => document.getElementById(id);

      const payTypes = [
        { value:"FULL", label:"Full pay" },
        { value:"HALF", label:"Half pay" },
        { value:"SMP",  label:"SMP only" },
        { value:"UNPAID", label:"Unpaid (arrears build)" }
      ];

      const monthsGrid = $("monthsGrid");
      const monthsCount = $("monthsCount");
      const hasAdditional = $("hasAdditional");
      const additionalMonthly = $("additionalMonthly");
      const recoverAdditionalArrears = $("recoverAdditionalArrears");
      const spreadPay = $("spreadPay");
      const spreadWarning = $("spreadWarning");

      const resultsBody = $("resultsBody");
      const resultsFoot = $("resultsFoot");
      const validation = $("validation");
      const arrearsMsg = $("arrearsMsg");

      const totEmpDed = $("totEmpDed");
      const totEmpArr = $("totEmpArr");
      const totAddDed = $("totAddDed");
      const totAddArr = $("totAddArr");

      const status = $("status");

      function fmtGBP(n){
        const x = Number(n || 0);
        return x.toLocaleString("en-GB",{style:"currency",currency:"GBP"});
      }

      function num(v){
        const n = Number(v);
        return Number.isFinite(n) ? n : 0;
      }

      function buildMonthRow(i){
        const row = document.createElement("div");
        row.className = "row";
        row.setAttribute("data-idx", String(i));

        const monthCol = document.createElement("div");
        monthCol.innerHTML = `<label>Month</label>
                              <input value="${i+1}" disabled aria-label="Month number ${i+1}" />`;

        const typeCol = document.createElement("div");
        const opts = payTypes.map(pt => `<option value="${pt.value}">${pt.label}</option>`).join("");
        typeCol.innerHTML = `<label for="type_${i}">Pay type</label>
                             <select id="type_${i}" aria-label="Pay type for month ${i+1}">${opts}</select>`;

        const payCol = document.createElement("div");
        payCol.innerHTML = `<label for="pay_${i}">Pensionable pay actually paid (£)</label>
                            <input id="pay_${i}" type="number" inputmode="decimal" min="0" step="0.01" placeholder="e.g. 1800.00" aria-label="Pensionable pay for month ${i+1}" />
                            <div class="small">Enter 0 if none (but use “Unpaid” if it’s an unpaid month).</div>`;

        const noteCol = document.createElement("div");
        noteCol.innerHTML = `<label>Help</label>
                             <div class="note" style="padding:10px;">
                               <div><strong>Unpaid month:</strong> pension is still due — arrears are estimated using your pre-leave pensionable pay.</div>
                             </div>`;

        row.appendChild(monthCol);
        row.appendChild(typeCol);
        row.appendChild(payCol);
        row.appendChild(noteCol);

        // behaviour: disable pay input when Unpaid
        setTimeout(() => {
          const type = $("type_"+i);
          const pay = $("pay_"+i);
          type.addEventListener("change", () => {
            const v = type.value;
            if(v === "UNPAID"){
              pay.value = "";
              pay.disabled = true;
              pay.placeholder = "Not used (arrears calculated)";
            } else {
              pay.disabled = false;
              pay.placeholder = "e.g. 1800.00";
            }
          });
        }, 0);

        return row;
      }

      function rebuildGrid(){
        monthsGrid.innerHTML = "";
        const count = Number(monthsCount.value || 12);
        for(let i=0;i<count;i++){
          monthsGrid.appendChild(buildMonthRow(i));
        }
        status.textContent = `Planner updated: ${count} month(s).`;
      }

      function setAdditionalEnabled(){
        const on = hasAdditional.checked;
        additionalMonthly.disabled = !on;
        recoverAdditionalArrears.disabled = !on;
        if(!on){
          additionalMonthly.value = "";
          recoverAdditionalArrears.checked = false;
        }
      }

      function setSpreadWarning(){
        spreadWarning.style.display = spreadPay.checked ? "block" : "none";
      }

      function validateInputs(){
        const empRate = num($("empRate").value);
        const preLeave = num($("preLeavePay").value);
        const count = Number(monthsCount.value || 12);

        const errors = [];
        if(empRate <= 0) errors.push("Enter your employee contribution rate (%).");
        if(preLeave < 0) errors.push("Pre-leave pensionable pay cannot be negative.");

        // If any month is Unpaid, preLeave should be provided
        let hasUnpaid = false;
        for(let i=0;i<count;i++){
          const type = $("type_"+i).value;
          if(type === "UNPAID") hasUnpaid = true;

          if(type !== "UNPAID"){
            const pay = $("pay_"+i);
            const payVal = pay.value.trim();
            if(payVal === ""){
              errors.push(`Month ${i+1}: enter the pensionable pay actually paid (or set to Unpaid if appropriate).`);
            } else if(num(payVal) < 0){
              errors.push(`Month ${i+1}: pensionable pay cannot be negative.`);
            }
          }
        }
        if(hasUnpaid && preLeave <= 0){
          errors.push("You have at least one Unpaid month — enter your pre-leave monthly pensionable pay so arrears can be estimated.");
        }

        if(hasAdditional.checked){
          const add = num(additionalMonthly.value);
          if(add <= 0) errors.push("You ticked additional contributions — enter your normal monthly additional contribution amount.");
        }

        return errors;
      }

      function calc(){
        validation.style.display = "none";
        validation.innerHTML = "";
        resultsFoot.style.display = "none";
        arrearsMsg.style.display = "none";

        const errors = validateInputs();
        if(errors.length){
          validation.style.display = "block";
          validation.innerHTML = "<strong>Please check:</strong><ul style='margin:8px 0 0 18px;'>" +
            errors.map(e => `<li>${e}</li>`).join("") +
            "</ul>";
          return;
        }

        const empRate = num($("empRate").value) / 100;
        const preLeave = num($("preLeavePay").value);
        const count = Number(monthsCount.value || 12);

        const addOn = hasAdditional.checked;
        const addMonthly = addOn ? num(additionalMonthly.value) : 0;
        const addArrearsOnUnpaid = addOn ? recoverAdditionalArrears.checked : false;

        let totalEmpDed = 0, totalEmpArr = 0, totalAddDed = 0, totalAddArr = 0;
        let anyArrears = false;

        const rows = [];

        for(let i=0;i<count;i++){
          const type = $("type_"+i).value;
          const typeLabel = payTypes.find(p=>p.value===type)?.label || type;
          let payUsed = 0;
          let empDed = 0;
          let empArr = 0;
          let addDed = 0;
          let addArr = 0;
          let note = "";

          if(type === "UNPAID"){
            payUsed = preLeave;
            empArr = payUsed * empRate;
            empDed = 0;
            note = "Unpaid month: estimated employee arrears based on pre-leave pensionable pay.";
            anyArrears = true;

            if(addOn){
              // additional contributions during unpaid months:
              // often will fall into arrears if payroll cannot deduct
              if(addArrearsOnUnpaid){
                addArr = addMonthly;
                addDed = 0;
                note += " Additional contribution estimated as arrears.";
                anyArrears = true;
              } else {
                // show as £0 unless user wants arrears estimate
                addDed = 0;
                addArr = 0;
                note += " Additional contribution not estimated as arrears (toggle on if needed).";
              }
            }
          } else {
            payUsed = num($("pay_"+i).value);
            empDed = payUsed * empRate;
            empArr = 0;

            if(addOn){
              // simple, staff-friendly approach: repeat the normal monthly additional deduction
              addDed = addMonthly;
              addArr = 0;
              note = "Paid month: employee deduction based on pensionable pay actually received. Additional contribution shown as your normal monthly amount.";
            } else {
              note = "Paid month: employee deduction based on pensionable pay actually received.";
            }
          }

          totalEmpDed += empDed;
          totalEmpArr += empArr;
          totalAddDed += addDed;
          totalAddArr += addArr;

          rows.push({
            month: i+1,
            typeLabel,
            payUsed,
            empDed,
            empArr,
            addDed,
            addArr,
            note
          });
        }

        // Render
        resultsBody.innerHTML = rows.map(r => `
          <tr>
            <td>Month ${r.month}</td>
            <td>${r.typeLabel}</td>
            <td class="right">${fmtGBP(r.payUsed)}</td>
            <td class="right">${fmtGBP(r.empDed)}</td>
            <td class="right">${fmtGBP(r.empArr)}</td>
            <td class="right">${fmtGBP(r.addDed)}</td>
            <td class="right">${fmtGBP(r.addArr)}</td>
            <td class="muted">${r.note}</td>
          </tr>
        `).join("");

        totEmpDed.textContent = fmtGBP(totalEmpDed);
        totEmpArr.textContent = fmtGBP(totalEmpArr);
        totAddDed.textContent = fmtGBP(totalAddDed);
        totAddArr.textContent = fmtGBP(totalAddArr);

        resultsFoot.style.display = "";
        if(anyArrears) arrearsMsg.style.display = "block";

        status.textContent = "Estimate updated.";
      }

      function resetAll(){
        $("empRate").value = "";
        $("preLeavePay").value = "";
        spreadPay.checked = false;
        setSpreadWarning();

        hasAdditional.checked = false;
        setAdditionalEnabled();

        // reset grid rows
        rebuildGrid();

        // clear results
        resultsBody.innerHTML = `<tr><td colspan="8" class="muted">No results yet — enter your figures and click “Calculate estimate”.</td></tr>`;
        resultsFoot.style.display = "none";
        arrearsMsg.style.display = "none";
        validation.style.display = "none";
        status.textContent = "Reset complete.";
      }

      // events
      monthsCount.addEventListener("change", rebuildGrid);
      hasAdditional.addEventListener("change", setAdditionalEnabled);
      spreadPay.addEventListener("change", setSpreadWarning);

      $("calcBtn").addEventListener("click", calc);
      $("resetBtn").addEventListener("click", resetAll);
      $("printBtn").addEventListener("click", () => window.print());

      // init
      rebuildGrid();
      setAdditionalEnabled();
      setSpreadWarning();
      status.textContent = "Ready.";
    })();
  </script>
</div>
