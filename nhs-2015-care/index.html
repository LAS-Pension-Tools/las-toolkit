<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NHS 2015 Pension (CARE) Calculator — v2.1</title>
  <link rel="stylesheet" href="./assets/styles.css" />
</head>
<body>
  <header class="site-header">
    <h1>NHS 2015 Pension (CARE) — v2.1</h1>
    <p>Year-by-year CARE (pay ÷ 54), pot-by-pot revaluation to retirement, with Estimate/Award mode, VER/AGE/LATE, ERRBO, commutation (12:1), and an audit trail.</p>
  </header>

  <main class="wrap">
    <nav class="tabs" role="tablist">
      <button class="tab active" data-tab="calc" role="tab" aria-selected="true">Calculator</button>
      <button class="tab" data-tab="ara" role="tab" aria-selected="false">ARA Admin</button>
      <button class="tab" data-tab="retirement" role="tab" aria-selected="false">Retirement & Factors</button>
      <button class="tab" data-tab="audit" role="tab" aria-selected="false">Audit</button>
      <button class="tab" data-tab="settings" role="tab" aria-selected="false">Settings</button>
    </nav>

    <section id="panel-calc" class="panel active" role="tabpanel">
      <div class="card">
        <header class="card-header">
          <strong>CARE build-up (enter pensionable pay per scheme year)</strong>
          <div class="muted">Accrual = pay ÷ 54. Each completed year is a separate pot, revalued by ARA while active. Final year adds April→LDoM accrual.</div>
        </header>

        <div class="controls">
          <label>Retirement date <input id="retDate" type="date"/></label>
          <label>Mode
            <select id="mode">
              <option value="estimate">Estimate (apply retirement-year ARA)</option>
              <option value="award">Award (suppress retirement-year ARA)</option>
            </select>
          </label>
          <button id="recalcBtn" class="btn">Recalculate</button>
          <button id="addYearBtn" class="btn outline">Add Year</button>
          <button id="seedYearsBtn" class="btn outline">Seed 2016→Final</button>
          <button id="exportBtn" class="btn outline">Export CSV</button>
          <div class="spacer"></div>
          <label>ABS/Estimate target (£): <input id="absTarget" type="number" step="0.01" placeholder="e.g. 9303.41"/></label>
        </div>

        <div class="table-wrap">
          <table id="calcTable">
            <thead>
              <tr>
                <th class="center">Scheme Year</th>
                <th class="center">Year End<br/>(31 Mar)</th>
                <th class="center">ARA<br/>(decimal)</th>
                <th>Pensionable Pay (£)</th>
                <th>Accrual (Pay/54) (£)</th>
                <th class="center">Actions</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>

        <div class="summary">
          <div><strong>Unreduced 2015 pension at retirement:</strong> <span id="unreducedOut">£0.00</span></div>
          <div>Difference (Calc − Target): <span id="diffPill" class="pill">£0.00</span></div>
        </div>
      </div>
    </section>

    <section id="panel-ara" class="panel" role="tabpanel">
      <div class="card">
        <header class="card-header">
          <strong>Active Revaluation (ARA) — Admin</strong>
          <div class="muted">ARA = CPI (Sept) + 1.5% while active. Use the NHS defaults or import JSON.</div>
        </header>
        <div class="controls">
          <button id="araAddYearBtn" class="btn outline">Add Year</button>
          <button id="araResetBtn" class="btn outline danger">Reset (current defaults)</button>
          <button id="araNHSDefaultsBtn" class="btn">Reset to NHS set (2016→2025)</button>
          <button id="araExportBtn" class="btn outline">Export JSON</button>
          <label class="btn file">Import JSON<input id="araImportInput" type="file" accept="application/json" /></label>
          <div class="spacer"></div>
          <button id="araApplyBtn" class="btn">Apply to Calculator</button>
        </div>
        <div class="table-wrap">
          <table id="araTable">
            <thead>
            <tr>
              <th class="center">Scheme Year</th>
              <th class="center">Year End</th>
              <th class="center">ARA (decimal)</th>
              <th class="center">Actions</th>
            </tr>
            </thead>
            <tbody id="araBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="panel-retirement" class="panel" role="tabpanel">
      <div class="card">
        <header class="card-header">
          <strong>Retirement & Factors</strong>
          <div class="muted">Compute VER/AGE/LATE & commutation. Import ERF/LRF (months → factor). ERRBO reduces months-early.</div>
        </header>

        <div class="controls">
          <label>Date of birth <input id="dob" type="date"/></label>
          <label>NPA age (years) <input id="npaAge" type="number" step="0.1" value="67"/></label>
          <label>Retirement type
            <select id="retType">
              <option value="age">Age (at NPA)</option>
              <option value="early">VER (before NPA)</option>
              <option value="late">Late (after NPA)</option>
            </select>
          </label>
          <label>ERRBO (years, 0–3) <input id="errboYears" type="number" min="0" max="3" step="0.25" value="0"/></label>
          <label>Pension to commute (£/yr) <input id="commutePension" type="number" step="0.01" value="0"/></label>
          <div class="spacer"></div>
          <button id="calcRetBtn" class="btn">Apply factors</button>
        </div>

        <div class="results-grid">
          <div class="result"><span class="k">Unreduced 2015 at retirement</span><span id="resUnreduced">£0.00</span></div>
          <div class="result"><span class="k">Months to/from NPA (after ERRBO)</span><span id="resMonths">0</span></div>
          <div class="result"><span class="k">Factor applied (ERF/LRF)</span><span id="resFactor">1.0000</span></div>
          <div class="result"><span class="k">After VER/AGE/LATE factor</span><span id="resAfterFactor">£0.00</span></div>
          <div class="result"><span class="k">Lump sum (12:1)</span><span id="resLump">£0.00</span></div>
          <div class="result"><span class="k">Payable pension</span><span id="resPayable">£0.00</span></div>
        </div>
      </div>

      <div class="card" style="margin-top:14px;">
        <header class="card-header">
          <strong>ERF & LRF Tables</strong>
          <div class="muted">Upload NHS 2015 tables as JSON or CSV with <code>months,factor</code>.</div>
        </header>
        <div class="controls">
          <button id="erfExportBtn" class="btn outline">Export ERF JSON</button>
          <label class="btn file">Import ERF<input id="erfImport" type="file" accept="application/json,.csv,text/csv" /></label>
          <button id="lrfExportBtn" class="btn outline">Export LRF JSON</button>
          <label class="btn file">Import LRF<input id="lrfImport" type="file" accept="application/json,.csv,text/csv" /></label>
          <div class="spacer"></div>
          <button id="resetFactorsBtn" class="btn outline danger">Reset ERF/LRF to 0→1.0000</button>
        </div>
        <div class="table-wrap">
          <table id="factorsTable">
            <thead>
              <tr><th class="center">Type</th><th class="center">Months</th><th class="center">Factor</th><th class="center">Actions</th></tr>
            </thead>
            <tbody id="factorsBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="panel-audit" class="panel" role="tabpanel">
      <div class="card">
        <header class="card-header">
          <strong>Pot-by-pot audit</strong>
          <div class="muted">Each year’s accrual, the ARA multiplier to retirement (per mode), and its revalued amount.</div>
        </header>
        <div class="table-wrap">
          <table id="auditTable">
            <thead>
              <tr>
                <th class="center">Scheme Year</th>
                <th class="center">Year End</th>
                <th>Accrual (Pay/54)</th>
                <th>Revaluation multiplier</th>
                <th>Revalued amount</th>
              </tr>
            </thead>
            <tbody id="auditBody"></tbody>
            <tfoot>
              <tr><td colspan="4" style="text-align:right;">Sum of revalued pots + part-year accrual:</td><td id="auditTotal">£0.00</td></tr>
            </tfoot>
          </table>
        </div>
      </div>
    </section>

    <section id="panel-settings" class="panel" role="tabpanel">
      <div class="card">
        <header class="card-header"><strong>Settings & Embed</strong></header>
        <div class="settings-grid">
          <div class="setting">
            <label class="label">Theme</label>
            <div class="row">
              <select id="themeSelect">
                <option value="system">System</option>
                <option value="light">Light</option>
                <option value="dark">Dark</option>
              </select>
              <span class="muted">Dark mode is tuned for Workvivo columns.</span>
            </div>
          </div>
          <div class="setting">
            <label class="label">Compact mode</label>
            <div class="row">
              <input id="compactToggle" type="checkbox"/>
              <span class="muted">Tighter spacing for embeds.</span>
            </div>
          </div>
          <div class="setting">
            <label class="label">Embed code</label>
            <div class="row">
              <input id="embedAbs" type="number" step="0.01" placeholder="e.g. 9303.41"/>
              <button id="copyEmbedBtn" class="btn outline">Copy iframe</button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div>For guidance only. Deferred PI revaluation after leaving not yet implemented.</div>
  </footer>

  <script src="./assets/app.js"></script>
</body>
</html>
