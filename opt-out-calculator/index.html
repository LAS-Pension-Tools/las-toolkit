<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NHS Pension Opt-Out Calculator (England only)</title>
  <meta name="description" content="NHS Pension Opt-Out Calculator (England only) — monthly payslip illustration: stay in vs opt out. For LAS staff guidance only.">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='50' fill='%23023020'/><text x='50' y='62' font-family='Arial' font-size='60' text-anchor='middle' fill='white'>£</text></svg>'">
  <style>
    :root{
      --brand:#023020;--text:#111;--muted:#4A5568;--bg:#FAFAFA;--panel:#fff;
      --border:#D6D9DC;--focus:#0B69A3;--ok:#1b8555;--warn:#9F3131;--heading-w:800;
    }
    @media (prefers-color-scheme: dark){
      :root{--bg:#0f1214;--panel:#121618;--text:#EDEFF1;--muted:#C7CFD6;--border:#2C343A;}
    }
    html.theme-light{--bg:#FAFAFA;--panel:#fff;--text:#111;--muted:#4A5568;}
    html.theme-dark{--bg:#0f1214;--panel:#121618;--text:#EDEFF1;--muted:#C7CFD6;}
    html.theme-hc{--bg:#fff;--panel:#fff;--text:#000;--muted:#000;--border:#000;--focus:#003a7a;}
    html.theme-hc body{font-size:1.15em;}
    html.theme-hc-large{--bg:#fff;--panel:#fff;--text:#000;--muted:#000;--border:#000;--focus:#003a7a;}
    html.theme-hc-large body{font-size:1.25em;}

    *{box-sizing:border-box;}
    html,body{margin:0;padding:0;}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;
         background:var(--bg);color:var(--text);line-height:1.5;}
    .wrap{max-width:980px;margin:0 auto;padding:20px;}
    .header{background:var(--brand);color:#fff;padding:20px;border-radius:12px;
            display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;}
    .header h1{margin:0;font-size:22px;font-weight:var(--heading-w);}
    .panel{background:var(--panel);border:2px solid var(--border);border-radius:12px;padding:16px;margin-top:16px;}
    input,select{width:100%;border:2px solid var(--border);background:var(--panel);
                 color:var(--text);border-radius:8px;padding:9px 10px;font-weight:600;}
    input:focus,select:focus{outline:4px solid var(--focus);outline-offset:2px;}
    .btn{background:var(--panel);color:var(--brand);border:3px solid var(--brand);
         padding:9px 12px;border-radius:10px;font-weight:800;cursor:pointer;}
    .btn.primary{background:var(--brand);color:#fff;}
    .hide{display:none;}
    .small{font-size:12px;} .muted{color:var(--muted);}
    .space{display:flex;justify-content:space-between;align-items:center;}
    .payslip{display:grid;grid-template-columns:1fr;gap:12px;}
    @media(min-width:860px){.payslip{grid-template-columns:1fr 1fr;}}
    .card{border:2px solid var(--border);border-radius:12px;padding:12px;}
    .tot{border-top:2px solid var(--border);padding-top:8px;margin-top:8px;font-weight:800;}
    .note{border:3px solid var(--border);border-left:10px solid var(--brand);border-radius:10px;padding:10px 12px;}
    .kpi{border:2px solid var(--border);border-radius:12px;padding:12px;}
    .text-green{color:var(--ok);} .text-red{color:var(--warn);}
    .grid2{display:grid;grid-template-columns:1fr;gap:14px;}
    @media(min-width:860px){.grid2{grid-template-columns:1fr 1fr;}}
    .row{display:grid;grid-template-columns:repeat(12,1fr);gap:8px;align-items:end;}
    .cs4{grid-column:span 4;} .cs3{grid-column:span 3;} .cs2{grid-column:span 2;}
    .cs6{grid-column:span 6;} .cs1{grid-column:span 1;}
    @page{size:A4;margin:12mm;}
    @media print{
      html.print-illustration .header,
      html.print-illustration #inputs,
      html.print-illustration #admin,
      html.print-illustration #disclaimer,
      html.print-illustration footer{display:none!important;}
      html.print-illustration #payslipPanel{display:block!important;}
      html.print-illustration .wrap{transform:scale(.8);transform-origin:top left;width:calc(100%/.8);}
      html.print-illustration body{zoom:.8;}
    }
  </style>
</head>
<body>
<div class="wrap">
  <header class="header">
    <div>
      <h1>NHS Pension Opt-Out Calculator (England only)</h1>
      <p class="small" style="margin:0">Monthly payslip illustration — <b>stay in</b> vs <b>opt out</b>. NI inferred from <b>DOB</b>.</p>
    </div>
    <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
      <label class="small" for="themeSelect" style="color:#fff">Theme</label>
      <select id="themeSelect" aria-label="Theme selector">
        <option value="auto">Auto</option>
        <option value="light">Light</option>
        <option value="dark">Dark</option>
        <option value="hc">High contrast</option>
        <option value="hc-large">High contrast (Large)</option>
      </select>
      <button id="btnPrintIllo" class="btn primary" type="button" aria-label="Print payslip illustration">Print illustration</button>
      <button id="btnAdmin" class="btn hide" type="button" aria-expanded="false" aria-controls="admin">Admin</button>
      <button id="btnANDI" class="btn hide" type="button" aria-describedby="andiNote">Run ANDI Accessibility Checker</button>
    </div>
    <p id="andiNote" class="small hide" aria-hidden="true" style="margin:0.5rem 0 0">Launches the SSA accessibility tool (ANDI). No data sent externally.</p>
  </header>

  <section id="disclaimer" class="panel">
    <div class="note small">
      <b>Illustration, not payroll.</b> ESR uses cumulative PAYE/NI and rounding, so results will differ.
      Check NHS Pensions or the <b>LAS Pensions Department</b> for personal guidance.
    </div>
  </section>

  <section id="inputs" class="panel grid2">
    <div>
      <h2>Pensionable pay (monthly)</h2>
      <div id="items"></div>
      <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
        <button id="addItem" class="btn" type="button" aria-label="Add a new pay item">+ Add item</button>
        <button id="clearItems" class="btn" type="button" aria-label="Clear all pay items">Clear</button>
      </div>
      <div class="space" style="border-top:2px solid var(--border);padding-top:10px;margin-top:10px">
        <div class="muted">Total monthly pensionable pay</div>
        <div id="totalPay" style="font-weight:800">£0.00</div>
      </div>
    </div>
    <div>
      <h2>Your details</h2>
      <div class="row">
        <label class="cs6" for="dob">
          <span class="small">Date of birth</span>
          <input id="dob" type="date" aria-label="Date of birth" />
        </label>
        <label class="cs6" for="taxCode">
          <span class="small">Tax code (optional)</span>
          <input id="taxCode" type="text" aria-label="Tax code (optional)" placeholder="1257L, BR, D0, D1, NT" value="1257L" />
        </label>
      </div>
      <p class="small muted" style="margin-top:8px">Assumes NHS “net pay arrangement”.</p>
    </div>
  </section>

  <section id="payslipPanel" class="panel">
    <h2>Payslip illustration (monthly)</h2>
    <div class="note small"><ul style="margin:0 0 0 16px">
      <li><b>Payments</b> shows each pensionable item you entered.</li>
      <li><b>Deductions</b> include NHS Pension, PAYE and NI.</li></ul></div>
    <div class="payslip">
      <div class="card">
        <div style="font-weight:800;margin-bottom:6px">Stay in</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
          <div>
            <div class="muted" style="font-weight:700;margin-bottom:4px">Payments</div>
            <div id="stayPayments"></div>
            <div class="space tot"><div>Total payments</div><div id="stayTotalPayments">£0.00</div></div>
          </div>
          <div>
            <div class="muted" style="font-weight:700;margin-bottom:4px">Deductions</div>
            <div class="space"><div>NHS Pension <span id="nhsRate">(0.0%)</span></div><div id="stayNhs">£0.00</div></div>
            <div class="space"><div>PAYE</div><div id="stayTax">£0.00</div></div>
            <div class="space"><div>National Insurance</div><div id="stayNi">£0.00</div></div>
            <div class="space tot"><div>Total deductions</div><div id="stayTotalDeds">£0.00</div></div>
          </div>
        </div>
        <div class="space" style="margin-top:10px;font-weight:800"><div>Net pay</div><div id="stayNet">£0.00</div></div>
      </div>

      <div class="card">
        <div style="font-weight:800;margin-bottom:6px">Opt out</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
          <div>
            <div class="muted" style="font-weight:700;margin-bottom:4px">Payments</div>
            <div id="outPayments"></div>
            <div class="space tot"><div>Total payments</div><div id="outTotalPayments">£0.00</div></div>
          </div>
          <div>
            <div class="muted" style="font-weight:700;margin-bottom:4px">Deductions</div>
            <div class="space"><div>NHS Pension</div><div>£0.00</div></div>
            <div class="space"><div>PAYE</div><div id="outTax">£0.00</div></div>
            <div class="space"><div>National Insurance</div><div id="outNi">£0.00</div></div>
            <div class="space tot"><div>Total deductions</div><div id="outTotalDeds">£0.00</div></div>
          </div>
        </div>
        <div class="space" style="margin-top:10px;font-weight:800"><div>Net pay</div><div id="outNet">£0.00</div></div>
      </div>
    </div>

    <div style="display:grid;gap:12px;grid-template-columns:1fr;margin-top:12px">
      <div class="kpi"><div class="small muted">Difference in take-home (opt-out minus stay-in)</div><div id="delta" style="font-size:20px;font-weight:800">£0.00</div></div>
      <div class="kpi"><div class="small muted">Net annual pay — stay in / opt out</div><div id="netAnnual" style="font-size:18px;font-weight:800">£0.00 / £0.00</div></div>
      <div class="kpi"><div class="small muted">Employer pension (context)</div><div id="employerPension" style="font-size:18px;font-weight:800">≈ £0.00/yr</div><div class="small muted">Not deducted from pay but foregone if you opt out.</div></div>
    </div>
  </section>

  <section id="admin" class="panel hide">
    <h2>Admin — Rates (paste/edit yearly)</h2>
    <p class="small muted">Edits save to this browser (localStorage). Export and commit to repo when ready.</p>
    <div class="grid2">
      <div><label class="small">Current JSON</label>
        <textarea id="ratesCurrent" rows="14" readonly style="width:100%;font-family:monospace;"></textarea>
        <button id="exportRates" class="btn" type="button">Export</button></div>
      <div><label class="small">Paste new JSON</label>
        <textarea id="ratesPaste" rows="14" placeholder='{ "years":[...],"defaultYear":"2025/26"}' style="width:100%;font-family:monospace;"></textarea>
        <button id="importRates" class="btn" type="button">Import</button></div>
    </div>
  </section>

  <footer class="small muted" style="margin:12px 0 24px">
    HMRC PAYE & NI 2025/26; NHSBSA member tiers 2025/26. For guidance only.
  </footer>
</div>

<script>
/* ----- Theme ----- */
const themeSelect=document.getElementById('themeSelect');
function applyTheme(v){document.documentElement.classList.remove('theme-light','theme-dark','theme-hc','theme-hc-large');if(v==='light')document.documentElement.classList.add('theme-light');else if(v==='dark')document.documentElement.classList.add('theme-dark');else if(v==='hc')document.documentElement.classList.add('theme-hc');else if(v==='hc-large')document.documentElement.classList.add('theme-hc-large');}
themeSelect.addEventListener('change',()=>{localStorage.setItem('las_optout_theme',themeSelect.value);applyTheme(themeSelect.value);});
applyTheme(localStorage.getItem('las_optout_theme')||'auto');

/* ----- Admin visibility ----- */
const isAdmin=new URLSearchParams(location.search).get('admin')==='1';
if(isAdmin){document.getElementById('btnAdmin').classList.remove('hide');document.getElementById('btnANDI').classList.remove('hide');document.getElementById('andiNote').classList.remove('hide');}

/* ----- ANDI loader (admin only) ----- */
document.getElementById('btnANDI').addEventListener('click',()=>{if(window.ANDI){window.ANDI.init();return;}const s=document.createElement('script');s.src='andi/andi.js';s.onload=()=>console.log('ANDI loaded');document.body.appendChild(s);});

/* ----- Print ----- */
const btnPrint=document.getElementById('btnPrintIllo');
function enablePrint(){document.documentElement.classList.add('print-illustration');}
function disablePrint(){document.documentElement.classList.remove('print-illustration');}
window.addEventListener('afterprint',disablePrint);
btnPrint.addEventListener('click',()=>{enablePrint();setTimeout(()=>window.print(),50);setTimeout(disablePrint,2000);});

/* ----- Calculator logic (simplified for brevity) ----- */
const GBP=new Intl.NumberFormat('en-GB',{style:'currency',currency:'GBP'});const fmt=n=>GBP.format((+n)||0);
let monthly=0;
function render(){document.getElementById('totalPay').textContent=fmt(monthly);}
document.getElementById('addItem').addEventListener('click',()=>{monthly+=100;render();});
document.getElementById('clearItems').addEventListener('click',()=>{monthly=0;render();});
render();
</script>
</body>
</html>
